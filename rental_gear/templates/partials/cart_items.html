{% load static %}
{% load humanize %}

<div id="cart-container" class="space-y-4">
  {% for item in cart_items %}
  <div class="cart-item bg-white/70 backdrop-blur-md rounded-2xl shadow-sm border border-blue-100 hover:shadow-md transition-all duration-300 p-5 flex justify-between items-center"
       data-id="{{ item.id }}">
    
    <!-- Left: Item info -->
    <div class="flex flex-col">
      <h3 class="text-blue-900 font-semibold text-lg">{{ item.gear.name }}</h3>
      <p class="text-sm text-blue-700 mt-1">
        Quantity: <span class="font-medium">{{ item.quantity }}</span> |
        Days: <span class="font-medium">{{ item.days }}</span> |
        Price/day: <span class="font-medium">Rp {{ item.gear.price_per_day|floatformat:0|intcomma }}</span>
      </p>
      <p class="text-blue-900 font-semibold mt-2">
        Total: Rp {{ item.get_total_price|floatformat:0|intcomma }}
      </p>
    </div>

    <!-- Right: Remove button -->
    <button class="remove-btn px-4 py-2 text-sm font-medium text-blue-700 border border-blue-200 rounded-lg hover:bg-blue-50 hover:shadow-md transition-all duration-200"
            data-id="{{ item.id }}"
            data-url="{% url 'rental_gear:remove_from_cart_ajax' item.id %}">
      Remove
    </button>
  </div>
  {% empty %}
  <p class="text-center text-blue-700 py-8 bg-white/60 rounded-2xl shadow-inner">Your cart is empty ❄️</p>
  {% endfor %}
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
  const buttons = document.querySelectorAll(".remove-btn");

  buttons.forEach(btn => {
    btn.addEventListener("click", function() {
      const itemId = this.dataset.id;
      const url = this.dataset.url;
      const itemDiv = document.querySelector(`.cart-item[data-id='${itemId}']`);

      fetch(url, {
        method: "POST",
        headers: {
          "X-CSRFToken": "{{ csrf_token }}",
        },
      })
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          // Animasi fade out sebelum dihapus
          itemDiv.classList.add("opacity-0", "scale-95", "transition-all", "duration-300");
          setTimeout(() => itemDiv.remove(), 300);

          // Kalau semua item udah dihapus, tampilkan pesan kosong
          if (document.querySelectorAll(".cart-item").length === 1) {
            document.getElementById("cart-container").innerHTML =
              `<p class="text-center text-blue-700 py-8 bg-white/60 rounded-2xl shadow-inner">Your cart is empty ❄️</p>`;
          }
        }
      });
    });
  });
});
</script>

{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="max-w-2xl mx-auto mt-10 bg-white rounded-xl shadow-md p-6">
  <h2 class="text-2xl font-bold text-gray-800">{{ post.title }}</h2>
  <p class="mt-2 text-gray-700">{{ post.content }}</p>
  <p class="text-sm text-gray-500 mt-1">oleh {{ post.author.username }}</p>

  <!-- Tombol buka modal -->
  <div class="mt-6">
    <button
      id="openReplies"
      class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition">
      ðŸ’¬ See Reply ({{ replies|length }})
    </button>
  </div>
</div>

<!-- MODAL -->
<div id="replyModal"
     class="hidden fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50">
  <div class="bg-white w-full max-w-md rounded-lg shadow-lg p-6 relative">
    <button id="closeReplies" class="absolute top-2 right-3 text-gray-500 hover:text-gray-800 text-xl">Ã—</button>
    
    <h3 class="text-xl font-semibold text-gray-800 mb-4">Reply for "{{ post.title }}"</h3>

    <!-- Form tambah reply -->
    <form method="post" action="{% url 'forum:add_reply' post.id %}" class="mb-4">
      {% csrf_token %}
      <textarea name="content"
                placeholder="Create a Reply..."
                class="w-full p-2 border rounded-md mb-2 text-sm"></textarea>
      <button type="submit"
              class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 transition w-full">
        Send Reply
      </button>
    </form>

    <!-- Daftar reply -->
    <div class="max-h-64 overflow-y-auto border-t pt-2">
      {% for reply in replies %}
      <div class="p-3 border-b border-gray-200">
        <p class="text-gray-800 text-sm">{{ reply.content }}</p>
        <p class="text-gray-500 text-xs">oleh {{ reply.author.username }} â€” {{ reply.created_at|date:"H:i, d M Y" }}</p>
      </div>
      {% empty %}
      <p class="text-gray-400 text-sm text-center py-4">There's is no replies in here.</p>
      {% endfor %}
    </div>
  </div>
</div>

<!-- SCRIPT -->
<script>
document.getElementById("openReplies").addEventListener("click", () => {
  document.getElementById("replyModal").classList.remove("hidden");
});

document.getElementById("closeReplies").addEventListener("click", () => {
  document.getElementById("replyModal").classList.add("hidden");
});
</script>

{% endblock %}

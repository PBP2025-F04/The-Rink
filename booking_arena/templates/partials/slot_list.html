{# File: booking_arena/templates/partials/slot_list.html #}

<div data-is-bookable-date="{{ is_bookable_date|yesno:'True,False' }}">

{% if is_closed_today %}
    <p class.="slot-item slot-unavailable" style="justify-content: center; padding: 1rem; color: #856404;">Maaf, arena tutup pada {{ selected_date|date:"l, d F Y" }}.</p>
{% elif error %}
    <div class="slot-item slot-unavailable" style="justify-content: center; padding: 1rem; color: #856404;">
        {{ error }}
    </div>
{% elif not hourly_slots_data %}
    <div class="slot-item slot-unavailable" style="justify-content: center; padding: 1rem;">
        <p class="text-center text-sm">Tidak ada slot tersedia untuk {{ selected_date|date:"l, d F Y" }}.</p>
    </div>
{% else %}
    {% for hour_data in hourly_slots_data %}
        <div class="slot-item 
                {% if hour_data.status == 'Booked' and hour_data.is_user_booking %} slot-booked {% endif %}
                {% if hour_data.status == 'Booked' and not hour_data.is_user_booking %} slot-unavailable {% endif %}
                {% if hour_data.status == 'Unavailable' %} slot-unavailable {% endif %}
                {% if not is_bookable_date %} slot-unavailable {% endif %}"
             id="hour-slot-{{ hour_data.hour }}">

            {# Info Jam & Status #}
            <div>
                <span class="font-semibold" style="font-size: 1.05rem; margin-bottom: 2px;">
                    {{ hour_data.hour }}:00 - {{ hour_data.hour | add:"1" }}:00
                </span>
                <div class="text-xs" style="margin-top: 2px;">
                    {% if hour_data.status == 'Available' and is_bookable_date %}
                        <span style="color: #1a7431; font-weight: 500;">
                            Tersedia - {{ hour_data.price_info|default:"Rp 350000" }}
                        </span>
                    {% elif hour_data.status == 'Booked' and hour_data.is_user_booking %}
                        <span style="color: #0077b6; font-weight: 600;">
                            Booking Anda ({{ hour_data.booking_info.get_activity_display|default:"-" }})
                        </span>
                    {% elif hour_data.status == 'Booked' and not hour_data.is_user_booking %}
                        <span class="italic text-gray-500">
                            Booked by {{ hour_data.booking_info.user.username|default:"other" }}
                        </span>
                    {% elif hour_data.status == 'Unavailable' %}
                        <span class="italic text-gray-400">Unavailable</span>
                    {% else %}
                        <span class="italic text-gray-400">Past Date</span>
                    {% endif %}
                </div>
            </div>

            {# Tombol Aksi #}
            <div>
                {% if hour_data.status == 'Available' and is_bookable_date %}
                    <button type="button" class="btn-slot-action btn-action-book"
                            hx-get="{% url 'booking_arena:get_sport_modal' arena_id=arena.id hour=hour_data.hour %}?date={{ selected_date|date:'Y-m-d' }}" 
                            hx-target="#modal-container" 
                            hx-swap="innerHTML"
                            onclick="showModal()">
                        Pesan Slot
                    </button>

                {% elif hour_data.status == 'Booked' and hour_data.is_user_booking and is_bookable_date %}
                    <button type="button" class="btn-slot-action btn-action-cancel"
                            hx-post="{% url 'booking_arena:cancel_booking' hour_data.booking_info.id %}?from=arena"
                            hx-headers='{"X-CSRFToken":"{{ csrf_token }}"}'
                            hx-target="#slot-list-target" 
                            hx-swap="innerHTML"
                            hx-confirm="Anda yakin ingin membatalkan booking ini?">
                        Batalkan
                    </button>
                
                {% elif hour_data.status == 'Booked' and hour_data.is_user_booking and not is_bookable_date %}
                    <button type="button" class="btn-slot-action btn-action-disabled" disabled>
                        Booked
                    </button>

                {% else %}
                    <button type="button" class="btn-slot-action btn-action-disabled" disabled>
                        {% if not is_bookable_date %}Past{% else %}Booked{% endif %}
                    </button>
                {% endif %}
            </div>

        </div>
    {% endfor %}
{% endif %}

</div>